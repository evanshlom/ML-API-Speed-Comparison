-- benchmarks/post.lua - WRK script for POST requests with JSON payload
wrk.method = "POST"
wrk.body   = '{"features": [1.3062945790708504, -1.1000168432997073, 0.14829951007433184, -0.5934471255954861, -0.1803048793690421, -0.34389480514914367, -2.2620305077367333, -0.9789228205340337, 0.2935982645064981, -1.0715167633601215, 0.4516653634774566, 0.7465849289616113, 0.29547182915917886, 1.6067426378692558, 1.1370312074138789, -1.4701788858072096, 0.07346021140647135, 1.3708696870400283, -0.7942109966637294, 1.3915656071488216, -0.17360986959442837, -0.8317014126689999, -0.3419131023183835, 0.10310251684298617, 1.5845764013987262, 1.7349175848590648, -1.2653385980824736, -0.8350126674200078, 0.5443389504972372, -1.4131808950984743, 0.13257391684479033, 0.1680713223684577, -1.146161670910342, 0.09574599338695217, -0.4626591365118039, -0.6274955260011065, -0.13496427337848294, 0.1457972951983976, 0.6738431395246534, 0.06801614353547897, -1.6444492187899236, 0.46321131663996706, 0.09900796875083731, 0.36553987707772434, -0.7222252502232878, -0.26215590298979224, -0.16567331718683329, 0.4859091499339687, 1.5724828946169656, 1.8702438906860894, 1.0986571947109143, -1.4149698473700965, 0.8146800682112674, 1.4266984829831642, -0.36259108857440536, 1.2123278760300717, 0.8535194617369909, 0.6859237131702218, 0.38124551452064376, 0.2689572212005774, -0.9102146392115487, -0.5525162548041043, 0.6954743146519965, -0.14402187667100738, -1.3649056274569162, -0.001196644437258923, -0.46143500131112464, 0.3897017772447867, 0.40233296991946615, -1.3038626938639235, -0.37193651881027406, 0.5423048306269123, 0.819457080002691, -0.17096994830975062, 0.15590686640602408, -1.770620356569946, -0.25162205533605897, 1.2419131689729528, -2.390573353306321, -1.1666863403705012, -0.800219444869171, 0.15458810206352674, -1.06105826557235, -0.7728345622629081, 0.33303108251746183, -0.29835212247451937, 0.48430300377087576, -1.7995785839389973, 0.14040663845382073, -0.6724192292327731, 1.7007798954172455, 0.7722494184026395, -0.01984260263548445, -0.7793827737867248, -0.9657412022098733, -0.16943716787381424, 2.1222191207117693, 0.11387439816261893, -0.699523689503224, 0.099509860818589]}'
wrk.headers["Content-Type"] = "application/json"

-- Progress tracking for YouTube video
local counter = 0
local total_expected = 10000  -- Rough estimate for 10 seconds

function response(status, headers, body)
    counter = counter + 1
    
    -- Show progress at 10%, 20%, 30%, etc. - perfect for video!
    local progress_points = {1000, 2000, 3000, 4000, 5000, 6000, 7000, 8000, 9000, 10000}
    
    for i, point in ipairs(progress_points) do
        if counter == point then
            local percent = i * 10
            print("üöÄ Progress: " .. percent .. "% (" .. counter .. " requests completed)")
            break
        end
    end
end

function done(summary, latency, requests)
    -- Final dramatic results for the video
    print("")
    print("üéØ ===== FINAL RESULTS =====")
    print("üìä Total Requests: " .. summary.requests)
    print("‚è±Ô∏è  Duration: " .. string.format("%.2f", summary.duration / 1000000000) .. " seconds")
    print("üöÄ Throughput: " .. string.format("%.2f", summary.requests / (summary.duration / 1000000000)) .. " req/sec")
    print("üìà P95 Latency: " .. string.format("%.2f", latency:percentile(95) / 1000) .. "ms")
    print("‚úÖ Test Complete!")
    print("")
end